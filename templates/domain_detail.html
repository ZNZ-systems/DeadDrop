{{define "title"}}{{.Domain.Name}} â€” DeadDrop{{end}}
{{define "content"}}
<div class="page-header">
    <h1 class="page-title">{{.Domain.Name}}</h1>
    <form method="POST" action="/domains/{{.Domain.PublicID}}/delete"
          onsubmit="return confirm('Delete this domain and all its messages?')">
        <input type="hidden" name="csrf_token" value="{{.CSRFToken}}">
        <button type="submit" class="btn-outline-red btn-sm">Delete Domain</button>
    </form>
</div>

{{if not .Domain.Verified}}
<div class="info-panel info-panel-warn">
    <div class="info-panel-title">DNS Verification Required</div>
    <p class="info-panel-text">Add this TXT record to your domain's DNS settings:</p>
    <div class="code-block">
        <span class="hl">deaddrop-verify</span>=<span class="val">{{.Domain.VerificationToken}}</span>
    </div>
    <form method="POST" action="/domains/{{.Domain.PublicID}}/verify" style="margin-top: 1.25rem;">
        <input type="hidden" name="csrf_token" value="{{.CSRFToken}}">
        <button type="submit" class="btn-outline btn-sm">Check Verification</button>
    </form>
</div>
{{else}}
<div class="info-panel info-panel-success">
    <div class="info-panel-title">Domain Verified</div>
    <p class="info-panel-text">Now route both channels into a mailbox: website widget + inbound email.</p>

    {{if .Mailbox}}
    <p class="info-panel-text" style="margin-top: .75rem;">
        Mailbox ready:
        <a href="/mailboxes/{{.Mailbox.PublicID}}" class="back-link" style="display: inline; margin: 0 0 0 .35rem;">open {{.Mailbox.Name}}</a>
    </p>
    {{else}}
    <p class="info-panel-text" style="margin-top: .75rem;">
        Next step:
        <a href="/mailboxes/new?domain_id={{.Domain.ID}}&from_address={{urlquery .SuggestedFrom}}" class="back-link" style="display: inline; margin: 0 0 0 .35rem;">create mailbox</a>
        (recommended from address: <strong>{{.SuggestedFrom}}</strong>)
    </p>
    {{end}}

    {{if .FormWidgetID}}
    <p class="info-panel-text" style="margin-top: 1rem;">Widget embed (this sends to your mailbox form stream):</p>
    <div class="code-block">
        <span class="hl">&lt;script</span> <span style="color:#f5f0e8;">src</span>=<span class="val">"{{$.BaseURL}}/static/widget.js"</span>
        <span style="color:#f5f0e8;">data-deaddrop-id</span>=<span class="val">"{{.FormWidgetID}}"</span><span class="hl">&gt;&lt;/script&gt;</span>
    </div>
    {{else}}
    <p class="info-panel-text" style="margin-top: 1rem;">No form stream found yet. Create a mailbox (or open an existing mailbox) to generate a widget stream ID.</p>
    {{end}}

    {{if .EmailStreamAddress}}
    <p class="info-panel-text" style="margin-top: .75rem;">Inbound email stream address: <strong>{{.EmailStreamAddress}}</strong></p>
    {{else}}
    <p class="info-panel-text" style="margin-top: .75rem;">No email stream found yet. Add one in the mailbox page (for example: <strong>{{.SuggestedFrom}}</strong>).</p>
    {{end}}
</div>
{{end}}

<div class="section-divider">
    <span class="num">01</span>
    <span>Messages</span>
</div>

{{if .Messages}}
<div class="list-card" id="messages" style="margin-top: 0; border-top: none;">
    {{range .Messages}}
    {{template "message_row" .}}
    {{end}}
</div>
{{else}}
<div class="empty-state" style="border-top: none;">
    <p>No messages yet. Once the widget is installed, messages will appear here.</p>
</div>
{{end}}

<a href="/" class="back-link">Back to domains</a>
{{end}}
